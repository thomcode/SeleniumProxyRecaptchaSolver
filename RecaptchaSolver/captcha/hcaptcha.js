(()=>{var k=chrome;var H="https://api.nopecha.com",m="https://www.nopecha.com",Y="https://developers.nopecha.com",Re={doc:{url:Y,automation:{url:`${Y}/guides/extension_advanced/#automation-build`}},api:{url:H,recognition:{url:`${H}/recognition`},status:{url:`${H}/status`}},www:{url:m,annoucement:{url:`${m}/json/announcement.json`},demo:{url:`${m}/demo`,hcaptcha:{url:`${m}/demo/hcaptcha`},recaptcha:{url:`${m}/demo/recaptcha`},funcaptcha:{url:`${m}/demo/funcaptcha`},awscaptcha:{url:`${m}/demo/awscaptcha`},textcaptcha:{url:`${m}/demo/textcaptcha`},turnstile:{url:`${m}/demo/turnstile`},perimeterx:{url:`${m}/demo/perimeterx`},geetest:{url:`${m}/demo/geetest`},lemincaptcha:{url:`${m}/demo/lemincaptcha`}},manage:{url:`${m}/manage`},pricing:{url:`${m}/pricing`},setup:{url:`${m}/setup`}},discord:{url:`${m}/discord`},github:{url:`${m}/github`,release:{url:`${m}/github/release`}}};function Q(e){let t=("bac8fe67f7824ec3da5dcab01c212ec3d24f95547e178b14236f731b54791ebc"+e).split("").map(n=>n.charCodeAt(0));return j(t)}var V=new Uint32Array(256);for(let e=256;e--;){let t=e;for(let n=8;n--;)t=t&1?3988292384^t>>>1:t>>>1;V[e]=t}function j(e){let t=-1;for(let n of e)t=t>>>8^V[t&255^n];return(t^-1)>>>0}async function h(e,t){let n=""+[+new Date,performance.now(),Math.random()],[a,r]=await new Promise(i=>{k.runtime.sendMessage([n,e,...t],i)});if(a===Q(n))return r}function T(){let e;return t=>e||(e=t().finally(()=>e=void 0),e)}var ke=T(),v;function J(){return ke(async()=>(v||(v=await h("settings::get",[])),v))}function G(e){v&&(v={...v,...e},Z(v))}function B(){return v}function p(e){return new Promise(t=>setTimeout(t,e))}var ee=[];function R(e,t){e.timedout=!1,ee.push(e);let n,a=setInterval(async()=>{await te(e,B())||(clearTimeout(n),clearInterval(a))},400);t&&(n=setTimeout(()=>clearInterval(a),t),e.timedout=!0)}async function te(e,t){if(e.timedout)return!1;let n=e.condition(t);if(n===e.running())return!1;if(!n&&e.running())return e.quit(),!1;if(n&&!e.running()){for(;!e.ready();)await p(200);return e.start(),!1}}function Z(e){ee.forEach(t=>te(t,e))}function ne(){k.runtime.connect({name:"stream"}).onMessage.addListener(t=>{t.event==="settingsUpdate"&&G(t.settings)})}function E(e){if(document.readyState!=="loading")setTimeout(e,0);else{let t;t=()=>{removeEventListener("DOMContentLoaded",t),e()},addEventListener("DOMContentLoaded",t)}}var nt=T();var Se=(e,t,n)=>new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t,screenY:n,clientX:t,clientY:n,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});function y(e,{events:t=null,x:n=null,y:a=null}={}){let r=document.querySelector(e);if(!r)return;if(n===null||a===null){let o=r.getBoundingClientRect();n=o.left+o.width/2,a=o.top+o.height/2}let i=t??["mouseover","mousedown","mouseup","click"];for(let o of i)r.dispatchEvent(Se(o,n,a))}function ae(e,t){return Math.random()*(t-e)+e}function P(e,t,n,a){let r=new MouseEvent(t,{bubbles:!0,cancelable:!0,clientX:n,clientY:a});e.dispatchEvent(r)}function oe(e,t,n,a,r,i=10,o=10,s=2){return new Promise(d=>{let l=document.querySelector(e);if(!l)return;let c=l.getBoundingClientRect();P(l,"mousedown",t+c.left,n+c.top);for(let u=1;u<=i;u++){let g=u/i,w=t+(a-t)*g,b=n+(r-n)*g,x=ae(-s,s),A=ae(-s,s);setTimeout(()=>{P(l,"mousemove",w+x+c.left,b+A+c.top)},u*o)}setTimeout(()=>{P(l,"mouseup",a+c.left,r+c.top),d()},i*o)})}var M,q=!1;function re(){return!!(document.querySelector("div.check")&&document.querySelector("#anchor"))}function ie(){q=!0;let e=document.querySelector("div.check"),t=document.querySelector("#anchor"),n=()=>{e?.style?.display==="block"||t.getAttribute("aria-hidden")=="true"||Ce()};M=new MutationObserver(n),M.observe(e,{attributes:!0}),M.observe(t,{attributes:!0}),n()}function se(){M.disconnect(),q=!1}function ce(){return q}async function Ce(){await p(400),y("#checkbox")}function S(e,t){let n=document.createElement("canvas");return n.width=e,n.height=t,n}function le(e){return new Promise((t,n)=>{let a=new Image;a.onload=()=>t(a),a.onerror=r=>n(r),a.src=`data:image/png;base64,${e}`})}function U(e){return e.toDataURL("image/jpeg").replace(/data:image\/[a-z]+;base64,/g,"")}function Ie(e){try{e.getContext("2d").getImageData(0,0,1,1)}catch{return!0}return!1}async function O(e,t,n=1e4){if(!t&&!e.complete&&!await new Promise(o=>{let s=setTimeout(()=>{o(!1)},n);e.addEventListener("load",()=>{clearTimeout(s),o(!0)})}))return;let a=S(e.naturalWidth||t?.clientWidth,e.naturalHeight||t?.clientHeight);return a.getContext("2d").drawImage(e,0,0),!Ie(a)&&a}async function ue(e){let n=getComputedStyle(e).backgroundImage;if(!n||n==="none")if("src"in e&&e.src)n=`url("${e.src}")`;else return;if("computedStyleMap"in e&&!/url\(["']https?:\/\//.test(n)){let d=e.computedStyleMap().get("background-image");if(d instanceof CSSImageValue){let l=await O(d,e);if(l)return l}}let a=/"(.+)"/.exec(n);if(!a)return;n=a[1];let r=document.createElement("a");if(r.href=n,new URL(r.href).origin===document.location.origin){let d=new Image;d.crossOrigin="anonymous",d.src=n;let l=await O(d);if(l)return l}let i=await h("fetch::asData",[n,{}]),o=new Image;o.crossOrigin="anonymous",o.src=i.data;let s=await O(o);if(s)return s}function de(e,t,n,a){let r=(a*t+n)*4;return[e[r],e[r+1],e[r+2]]}function me(e,t){return e.every(n=>n<=t)}function ge(e,t){return e.every(n=>n>=t)}function N(e,t=0,n=230,a=.99){let r=e.getContext("2d"),i=r.canvas.width,o=r.canvas.height;if(i===0||o===0)return!0;let s=r.getImageData(0,0,i,o).data,d=0;for(let c=0;c<o;c++)for(let u=0;u<i;u++){let g=de(s,i,u,c);(me(g,t)||ge(g,n))&&d++}return d/(i*o)>a}function pe(e,t=0,n=230,a=.1){let r=e.getContext("2d"),i=r.canvas.width,o=r.canvas.height,s=r.getImageData(0,0,i,o).data,d=Array(o).fill(0),l=Array(i).fill(0);for(let f=0;f<o;f++)for(let _=0;_<i;_++){let X=de(s,i,_,f);(me(X,t)||ge(X,n))&&(d[f]++,l[_]++)}let c=d.map((f,_)=>f/i<1-a?_:null).filter(f=>f!==null),u=l.map((f,_)=>f/o<1-a?_:null).filter(f=>f!==null);if(c.length===0||u.length===0)return{croppedCanvas:e,coordinates:[0,0,i-1,o-1]};let g=c[0],w=c[c.length-1],b=u[0],x=u[u.length-1];if(x-b+1===1||w-g+1===1)return{croppedCanvas:null,coordinates:[0,0,0,0]};let A=r.getImageData(b,g,x-b+1,w-g+1),K=S(x-b+1,w-g+1);return K.getContext("2d").putImageData(A,0,0),{croppedCanvas:K,coordinates:[b,g,x,w]}}function z(e,t=500,n=500){let a=e.getContext("2d"),r=a.canvas.width,i=a.canvas.height,o=a.getImageData(0,0,r,i),s=o.width,d=o.height,l=s/d,c=s,u=d;if(c>t&&(c=t,u=Math.floor(c/l)),u>n&&(u=n,c=Math.floor(u*l)),c===s&&u===d)return e;let g=S(s,d);g.getContext("2d").putImageData(o,0,0);let b=S(c,u);return b.getContext("2d").drawImage(g,0,0,s,d,0,0,c,u),b}function fe(){return[]}function he(e){return new Promise(t=>{e.push(t)})}function $(e){e.forEach(t=>t()),e.splice(0)}async function be(e,t){let n={v:k.runtime.getManifest().version,key:Te(e)};return n.url=await h("tab::getURL",[]),n}function Te(e){return!e.keys||!e.keys.length?e.key:e.keys[Math.floor(Math.random()*e.keys.length)]}var D=fe(),L,I=!1;function _e(){let e=document.querySelector(".challenge-container");return!(!e||e.childElementCount===0||!document.querySelector(".display-error")||!document.querySelector("body.no-selection")||!document.querySelector("div.button-submit.button"))}function ve(){I=!0,$(D),L=new MutationObserver(async()=>{setTimeout(()=>$(D),200)}),L.observe(document.querySelector(".display-error"),{attributes:!0,attributeFilter:["aria-hidden"]}),L.observe(document.querySelector("div.button-submit.button"),{attributes:!0,attributeFilter:["style"]}),Ae()}function we(){L.disconnect(),I=!1,$(D)}function xe(){return I}function Be(){document.querySelector(".display-language .text").textContent!=="EN"&&y(".language-selector .option:nth-child(23)")}async function C(e,t){let n=await ue(t);if(n&&!N(n))return e!==null&&(n=z(n,e,e)),U(n)}function W(){let e=document.querySelector("h2.prompt-text");if(e)return e.textContent.replace(/\s+/g," ").trim()}function F(){return new URLSearchParams(location.hash.substring(1)).get("sitekey")}var Me={[0]:{async getTask(){let e=W();if(!e)return;let t=[...document.querySelectorAll(".task-image")];if(t.length!==9)return;let n=(await Promise.all(t.map(i=>i.querySelector("div.image")).filter(i=>i).map(C.bind(this,128)))).filter(i=>i);if(n.length!==9)return;let a=[...document.querySelectorAll(".examples .image")],r=(await Promise.all(a.map(C.bind(this,128)))).filter(i=>i);return{cells:t,payload:{type:"hcaptcha",task:e,sitekey:F(),image_data:n,image_examples:r}}},async solution({cells:e},t){e.forEach((n,a)=>{let r=n.getAttribute("aria-pressed")=="true";t.data[a]!==r&&y(`.task:nth-child(${a+1})`)})}},[1]:{async getTask(){let e=W();if(!e)return;let t=document.querySelector(".task-image .image");if(!t)return;let n=await C(500,t);if(!n)return;let a=[...document.querySelectorAll(".challenge-answer")];if(a.length<2)return;let r=a.map(o=>o.querySelector(".text-content")?.textContent);if(r.some(o=>!o))return;let i=(await Promise.all(a.map(o=>o.querySelector("div.image")).filter(o=>o).map(C.bind(this,128)))).filter(o=>o);return{payload:{type:"hcaptcha_multiple_choice",task:e,sitekey:F(),image_data:[n],choices:r,image_choices:i}}},async solution(e,t){let n;Array.isArray(t.data)?n=t.data[0]:n=t.data;let a=e.payload.choices.indexOf(n);y(`.challenge-answer:nth-child(${a+1})`)}},[2]:{async getTask(){let e=W();if(!e)return;let t=document.querySelector(".challenge-view > canvas");if(!t||N(t))return;let{croppedCanvas:n,coordinates:a}=pe(t);if(!n)return;let r=z(n,500,500);if(!r)return;let i=U(r),o=[...document.querySelectorAll(".example-image .image")],s=(await Promise.all(o.map(C.bind(this,128)))).filter(d=>d);return{coordinates:a,payload:{type:"hcaptcha_area_select",task:e,sitekey:F(),image_data:[i],image_examples:s}}},async solution(e,t){let{x:n,y:a,w:r,h:i}=t.data,o=document.querySelector(".challenge-view > canvas"),s=e.coordinates,d=s[2]-s[0],l=s[3]-s[1];n=n/100*d+s[0],a=a/100*l+s[1],r=r/100*d,i=i/100*l;let c=o?+o.style.width.replace("px","")/+o.width:1,u=o?+o.style.height.replace("px","")/+o.height:1;r&&i?await oe(".challenge-view > canvas",n*c,a*u,(n+r)*c,(a+i)*u):y(".challenge-view > canvas",{events:["mousedown","mousemove","mouseup"],x:n*c,y:a*u})}}},$e=[[".challenge-view > .task-grid",0],[".challenge-view > .task-wrapper",1],[".challenge-view > .bounding-box-example",2]];function Le(){return $e.filter(([e])=>document.querySelector(e)).map(([e,t])=>t)[0]}async function De(e){if(e.payload.type==="hcaptcha_area_select"&&"image_data"in e.payload&&Array.isArray(e.payload.image_data)&&e.payload.image_data.length===1){let t=e.payload.image_data[0],a=S(500,500).getContext("2d"),r=await le(t);a.drawImage(r,0,0);let i=10,o=a.getImageData(0,0,500,i);return JSON.stringify({task:e.payload.task,top:o})}return JSON.stringify(e)}var ye=!1;async function Ae(){if(ye)return;ye=!0;let e,t=0;for(;I;){if(document.querySelector(".display-error[aria-hidden=false]"))for(;document.querySelector(".button-submit[title*=Submit], .button-submit[title*=Verify]");)await p(1e3);if(!document.querySelector(".challenge-container")?.childElementCount){await p(1e3);continue}Be(),await p(500);let n,a,r=!1;for(let l=0;l<30&&I;l++){l&&await p(1e3);let c=Le();if(c!==void 0&&(n=Me[c],a=await n.getTask(),a)){let u=await De(a);if(e&&u===e&&Date.now()<t)continue;e=u,r=!0,t=Date.now()+1e4;break}}if(!a||!r){y(".refresh"),await p(3e3);continue}let i=B(),o=new Date().valueOf(),s=await h("api::recognition",[{...a.payload,...await be(i)}]);if(!s||"error"in s){await p(2e3);continue}let d=new Date().valueOf();if(i.hcaptcha_solve_delay){let l=i.hcaptcha_solve_delay_time-d+o;l>0&&await p(l)}await n.solution(a,s),await p(200),y(".button-submit"),await he(D),await p(200)}}async function He(){ne(),await J(),await h("tab::registerDetectedCaptcha",["hcaptcha"]);let e=new URLSearchParams(location.hash.substring(1)),t=e.get("frame"),n=e.get("host");t==="checkbox"?R({name:"hcaptcha/auto-open",condition:a=>a.enabled&&a.hcaptcha_auto_open&&!a.disabled_hosts.includes(n),ready:re,start:ie,quit:se,running:ce}):R({name:"hcaptcha/auto-solve",condition:a=>a.enabled&&a.hcaptcha_auto_solve&&!a.disabled_hosts.includes(n),ready:_e,start:ve,quit:we,running:xe})}E(He);})();
