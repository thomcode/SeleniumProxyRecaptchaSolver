(()=>{{let t=chrome.runtime.getManifest().content_scripts.filter(o=>o.js.includes("eventhook.js")).map(o=>o.matches);chrome.scripting.getRegisteredContentScripts().then(o=>{o.length||chrome.scripting.registerContentScripts([{id:"1",matches:t.flat(),js:["eventhook/loader.js"],allFrames:!0,runAt:"document_start",world:"MAIN"}])})}var s=chrome;var x="https://api.nopecha.com",n="https://www.nopecha.com",D="https://developers.nopecha.com",m={doc:{url:D,automation:{url:`${D}/guides/extension_advanced/#automation-build`}},api:{url:x,recognition:{url:`${x}/recognition`},status:{url:`${x}/status`}},www:{url:n,annoucement:{url:`${n}/json/announcement.json`},demo:{url:`${n}/demo`,hcaptcha:{url:`${n}/demo/hcaptcha`},recaptcha:{url:`${n}/demo/recaptcha`},funcaptcha:{url:`${n}/demo/funcaptcha`},awscaptcha:{url:`${n}/demo/awscaptcha`},textcaptcha:{url:`${n}/demo/textcaptcha`},turnstile:{url:`${n}/demo/turnstile`},perimeterx:{url:`${n}/demo/perimeterx`},geetest:{url:`${n}/demo/geetest`},lemincaptcha:{url:`${n}/demo/lemincaptcha`}},manage:{url:`${n}/manage`},pricing:{url:`${n}/pricing`},setup:{url:`${n}/setup`}},discord:{url:`${n}/discord`},github:{url:`${n}/github`,release:{url:`${n}/github/release`}}};var Z="en",ee="en";{let e=function(t,o,r,a){return{id:a,priority:1,action:{type:"redirect",redirect:{transform:{queryTransform:{addOrReplaceParams:[{key:t,value:o}]}}}},condition:{regexFilter:r,resourceTypes:["sub_frame"]}}};s.declarativeNetRequest.updateDynamicRules({addRules:[e("hl",Z,"^https?://[^\\.]*\\.(google\\.com|recaptcha\\.net)/recaptcha",1),e("lang",ee,"^https?://[^\\.]*\\.(funcaptcha\\.com?|arkoselabs\\.c(om|n)|arkose\\.com\\.cn)/fc/gc/",2)],removeRuleIds:[1,2]})}var d=new Map;chrome.tabs.onUpdated.addListener((e,t)=>{d.has(e)&&!("url"in t)||d.set(e,new Set)});chrome.tabs.onRemoved.addListener(e=>{d.delete(e)});async function j([e],t){let o=t.tab?.id;if(!o)return console.warn("[@nope/background/tabs] unable to figure out tabId");d.has(o)||d.set(o,new Set),d.get(o).add(e)}async function q(){let e=await new Promise(t=>{s.tabs.query({active:!0,currentWindow:!0},([o])=>{t(o)})});return d.has(e.id)?[...d.get(e.id)]:[]}var h={version:18,key:"",keys:[],enabled:!0,disabled_hosts:[],awscaptcha_auto_open:!1,awscaptcha_auto_solve:!1,awscaptcha_solve_delay_time:1e3,awscaptcha_solve_delay:!0,geetest_auto_open:!1,geetest_auto_solve:!1,geetest_solve_delay_time:1e3,geetest_solve_delay:!0,funcaptcha_auto_open:!0,funcaptcha_auto_solve:!0,funcaptcha_solve_delay_time:1e3,funcaptcha_solve_delay:!0,hcaptcha_auto_open:!0,hcaptcha_auto_solve:!0,hcaptcha_solve_delay_time:3e3,hcaptcha_solve_delay:!0,lemincaptcha_auto_open:!1,lemincaptcha_auto_solve:!1,lemincaptcha_solve_delay_time:1e3,lemincaptcha_solve_delay:!0,perimeterx_auto_solve:!1,perimeterx_solve_delay_time:1e3,perimeterx_solve_delay:!0,recaptcha_auto_open:!0,recaptcha_auto_solve:!0,recaptcha_solve_delay_time:2e3,recaptcha_solve_delay:!0,textcaptcha_auto_solve:!1,textcaptcha_image_selector:"",textcaptcha_input_selector:"",textcaptcha_solve_delay_time:100,textcaptcha_solve_delay:!0,turnstile_auto_solve:!0,turnstile_solve_delay_time:1e3,turnstile_solve_delay:!0};var y=s.action,S=!0;function R(e){if(e===S)return;S=e;let t=e?"":"g",o=[new Promise(r=>{y.setIcon({path:Object.fromEntries([16,32,48,128].map(a=>[a,`/icon/${a}${t}.png`]))},r)})];return v&&o.push(new Promise(r=>{y.setBadgeText({text:e?v:""},r)})),Promise.all(o)}var v="";function w(e,t){if(e!==v)return v=e,Promise.all([new Promise(o=>{if(!S)return o();y.setBadgeText({text:e},o)}),new Promise(o=>{y.setBadgeBackgroundColor({color:t},o)})])}function U(e,t){return t.tab.url}function B(){return new Promise(e=>{s.tabs.query({active:!0,currentWindow:!0},([t])=>e(t))})}async function g(){return(await B()).id}async function J(){let e=await B();return e&&e.url&&new URL(e.url).href}async function N(){let e=await B();return JSON.stringify(e)}var P=new Set,I=new Set;s.runtime.onConnect.addListener(e=>{e.name==="stream"?(P.add(e),e.onDisconnect.addListener(()=>{P.delete(e)})):e.name==="broadcast"&&(I.add(e),e.onDisconnect.addListener(()=>{I.delete(e)}))});function M(e){P.forEach(t=>t.postMessage(e))}async function F(e){let t=await g();e={data:e,event:"broadcast"},I.forEach(o=>{o.sender?.tab?.id!==void 0&&t===o.sender?.tab?.id&&o.postMessage(e)})}var A=new Promise(e=>{s.storage.local.get("settings",t=>{if(!t?.settings)return e(h);let{settings:o}=t;o.version!==h.version&&(o={...h,key:o.key}),o.enabled||R(!1),e(o)})});function k(){return A}async function O(e){let t={...await A,...e};return R(t.enabled),new Promise(o=>{s.storage.local.set({settings:t},()=>{A=Promise.resolve(t),M({event:"settingsUpdate",settings:e}),o(null)})})}function E(){let e;return t=>e||(e=t().finally(()=>e=void 0),e)}var H,te=E();function L(){return te(()=>re())}async function V(){return H}var oe=s.runtime.getManifest().version;async function re(){let e=new URLSearchParams;e.append("v",oe);let t=(await k()).key;t&&e.append("key",t);let o=`${m.api.status.url}?${e.toString()}`,r,a=null;try{a=await fetch(o),r=await a.json()}catch(i){console.error("[@nope/background/api/status] failed to fetch status",a,i),r={error:-1,message:a?a.status===522?"Server not responding":a.status===502?"Server has routing issues":`Unknown server error: ${a.status}`:"Server connection failure."}}return a&&!a.ok&&(!r||!("error"in r))&&(console.error("[@nope/background/api/status] received non 2xx",a,r),r={error:-1,message:`Server error: ${a.status}`}),H=r,"error"in r?w("ERR","#FDE047"):typeof r.credit=="number"&&typeof r.quota=="number"?w(r.credit>=9999?`${Math.floor(r.credit/r.quota*100)}`:r.credit.toString(),r.credit?"#0a95ff":"#FB7185"):w("","#fff0"),r}L();function _(e){return new Promise(t=>setTimeout(t,e))}function $(e,t=2166136261){let o=t;for(let r of e)o^=r,o+=o<<1;return o>>>0}var ae=30,f=[];function T(e,t){let o;if(!t.method||t.method==="GET"){let a=new URLSearchParams(e.split("?")[1]).get("id");if(!a)return;let i=f.find(c=>{let u=c.postres[c.postres.length-1];return!u?.responseBody||!("data"in u.responseBody)?!1:u?.responseBody?.data===a});i&&(o=i.id,i.getreq={time:+new Date,url:e,options:t})}else for(o=""+[+new Date,performance.now(),Math.random()],f.push({id:o,postreq:{time:+new Date,url:e,options:t},getreq:{time:0,url:"",options:{}},postres:[],getres:[]});f.length>ae;)f.shift();return o}function b(e,t){let o=f.find(r=>r.id===e);o&&(o.getreq.time?(o.getres.push({time:+new Date,...t}),t.responseBody&&"data"in t.responseBody&&(o.answer=t.responseBody.data)):o.postres.push({time:+new Date,...t}))}function W(){return JSON.stringify(f)}var ne=[15,16,12,10,17];async function G(e){let t=new Headers;t.append("accept","application/json"),t.append("content-type","application/json");let o=typeof e.v=="string"?$(e.v.split("").map(c=>c.charCodeAt(0))):-1;e.key&&e.key!=="undefined"&&t.append("authorization",`Bearer ${e.key}`);let r;for(let c=30;c>0&&o===2860377014;c--){let u=T(m.api.url,{method:"POST",headers:t,body:e}),l=await fetch(m.api.url,{method:"POST",headers:t,body:JSON.stringify(e)});if(l.status>=500){b(u,{response:l,attempts:c}),await _(1e3);continue}let p=await l.json();if(b(u,{response:l,responseBody:p,attempts:c}),"error"in p){if(ne.includes(p.error))return p;p.error!==11&&console.warn("[@nope/background/api/recognition] unknown error",p),await _(1e3)}else{r=p.data;break}}if(!r)return{error:-1,message:"Server timeout"};t.delete("content-type");let a,i=`${m.api.url}?id=${r}&key=${e.key}`;for(let c=60;c>0;c--){a=T(i,{headers:t});let u=await fetch(i,{headers:t});if(u.status>=500){b(a,{response:u,attempts:c}),await _(1e3);continue}let l=await u.json();if(b(a,{response:u,responseBody:l,attempts:c}),"error"in l)l.error!==14&&console.warn("[@nope/background/api/recognition] unknown error",l),await _(1e3);else return l}return a&&b(a,{failed:!0}),{error:-1,message:"Server timeout"}}async function K([e,t]){let o=await fetch(e,t);return{headers:Object.fromEntries(o.headers.entries()),status:o.status,ok:o.ok,text:await o.text()}}async function X([e,t]){let o=await fetch(e,t),r=await o.blob(),a=new FileReader;return await new Promise(i=>{a.addEventListener("load",i),a.readAsDataURL(r)}),{headers:Object.fromEntries(o.headers.entries()),status:o.status,ok:o.ok,data:a.result}}function C(e){let t=("bac8fe67f7824ec3da5dcab01c212ec3d24f95547e178b14236f731b54791ebc"+e).split("").map(o=>o.charCodeAt(0));return Q(t)}var z=new Uint32Array(256);for(let e=256;e--;){let t=e;for(let o=8;o--;)t=t&1?3988292384^t>>>1:t>>>1;z[e]=t}function Q(e){let t=-1;for(let o of e)t=t>>>8^z[t&255^o];return(t^-1)>>>0}async function Y(e){!e&&(e=await g(),!e)||chrome.scripting.executeScript({target:{tabId:e,allFrames:!0},files:["lib/selector.js","locate.js"],world:"ISOLATED",injectImmediately:!0})}var se={"echo::sender":(e,t)=>t,"log::getLogs":W,"settings::get":k,"settings::update":([e])=>O(e),"api::fetchStatus":L,"api::getCachedStatus":V,"api::recognition":([e])=>G(e),"tab::getCurrentId":g,"tab::getCurrentJSON":N,"tab::getCurrentURL":J,"tab::getURL":U,"tab::registerDetectedCaptcha":j,"tab::getDetectedCaptchas":q,"fetch::universalFetch":K,"fetch::asData":X,"tab::broadcast":([e])=>F(e),"locator::inject":(e,t)=>Y(t?.tab?.id)};s.runtime.onMessage.addListener((e,t,o)=>{let r=e[1],a=se[r];return Promise.resolve(a(e.slice(2),t)).then(i=>{o([C(e[0]),i])}).catch(i=>{console.error(`[@nope/background/rpc] [${r}] errored!`,e.slice(2),i),o([C(e[0]),""+i])}),!0});})();
